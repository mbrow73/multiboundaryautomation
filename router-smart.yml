# Smart Router Configuration for VPC SC Automation
# No manual project mapping required - uses intelligent detection

perimeters:
  prod-perimeter-east:
    repo: yourorg/prod-east-vpcsc-config
    tfvars_file: terraform.auto.tfvars
    accesslevel_file: accesslevel.tf
    policy_id: 123456789

  prod-perimeter-west:
    repo: yourorg/prod-west-vpcsc-config
    tfvars_file: terraform.auto.tfvars
    accesslevel_file: accesslevel.tf
    policy_id: 234567890

  dev-perimeter:
    repo: yourorg/dev-vpcsc-config
    tfvars_file: terraform.auto.tfvars
    accesslevel_file: accesslevel.tf
    policy_id: 345678901

  staging-perimeter:
    repo: yourorg/staging-vpcsc-config
    tfvars_file: terraform.auto.tfvars
    accesslevel_file: accesslevel.tf
    policy_id: 456789012

# Perimeter Detection via Naming Patterns
# Projects matching these patterns are assigned to corresponding perimeters
perimeter_naming_patterns:
  prod-perimeter-east:
    - "^prod-east-"        # prod-east-app, prod-east-data
    - "^pe-"               # pe-analytics, pe-ml
    - "-prod-east$"        # customer-prod-east
    - "-prod-east-"        # team-prod-east-service

  prod-perimeter-west:
    - "^prod-west-"
    - "^pw-"
    - "-prod-west$"
    - "-prod-west-"

  dev-perimeter:
    - "^dev-"              # dev-app, dev-data
    - "^development-"
    - "-dev$"              # myapp-dev
    - "-dev-"              # team-dev-service

  staging-perimeter:
    - "^staging-"
    - "^stg-"
    - "-staging$"
    - "-stg$"

# Example Perimeter Names Extracted from Error Messages
# VPC SC errors contain perimeter names - we parse them automatically
# No configuration needed, but here are examples of what we detect:
#
# Error message formats detected:
# - "perimeterName: accessPolicies/123/servicePerimeters/prod-perimeter-east"
# - "denied by VPC Service Controls perimeter 'prod-perimeter-east'"
# - "restricted by servicePerimeters/prod-perimeter-east"

# Optional: GCP API Query (Expensive - Disabled by Default)
# Enable by setting environment variable: VPC_SC_ENABLE_GCP_QUERY=true
# This will query GCP API to find perimeters (slow for thousands of projects)
# Results are cached in /tmp/vpc_sc_project_cache.json
gcp_api_query:
  enabled: false              # Set to true only if needed
  cache_ttl_hours: 24        # How long to cache results
  cache_file: "/tmp/vpc_sc_project_cache.json"

# Fallback Strategy
# If perimeter cannot be auto-detected:
# 1. Show user a dropdown of all available perimeters
# 2. User selects manually
# 3. Their selection is used for the request
fallback:
  require_user_selection: true
  default_perimeter: null     # Don't auto-assign if unknown

# Service-specific defaults (same as before)
service_defaults:
  cross_perimeter_services:
    - bigquery.googleapis.com
    - storage.googleapis.com
    - pubsub.googleapis.com

  egress_only_services:
    - logging.googleapis.com
    - containerregistry.googleapis.com
